<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Performance History</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .history-container { padding: 40px; }
        .result-card { margin-bottom: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-radius: 10px; }
        .score-badge { font-size: 1.1rem; padding: 0.5em 1em; }
        .header-bg { background: linear-gradient(90deg, #2193b0, #6dd5ed); color: white; }
    </style>
</head>
<body>
    
    <nav class="navbar navbar-expand-lg navbar-dark header-bg">
        <div class="container-fluid">
            <a class="navbar-brand" href="{% url 'home' %}">Home</a>
            <div class="collapse navbar-collapse justify-content-end">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" href="{% url 'candidate_history' %}">History Tracker</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'logout' %}">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container history-container">
        <h1 class="mb-4">My Interview Performance History</h1>
        <p class="lead">Viewing results for: **{{ candidate.name }}**</p>

        {% if analysis_results %}
            <div class="row">
            {% for result in analysis_results %}
                <div class="col-md-12">
                    <div class="card result-card">
                        <div class="card-header header-bg">
                            **Analysis Run on:** {{ result.date_time|date:"F d, Y P" }}
                            <span class="float-end">Overall Score: <span class="badge bg-light text-dark score-badge">{{ result.overall_confidence|floatformat:2 }}%</span></span>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h5>Component Scores:</h5>
                                    <ul class="list-unstyled">
                                        <li>**Facial Expression:** <span class="badge bg-info">{{ result.expression_confidence|floatformat:2 }}%</span></li>
                                        <li>**Eye Movement:** <span class="badge bg-info">{{ result.eye_movement_confidence|floatformat:2 }}%</span></li>
                                        <li>**Speech:** <span class="badge bg-info">{{ result.speech_confidence|floatformat:2 }}%</span></li>
                                        <li>**Hand Gesture:** <span class="badge bg-info">{{ result.hand_gesture_confidence|floatformat:2 }}%</span></li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h5>Detailed Expression Duration (Seconds):</h5>
                                    <ul class="list-unstyled small">
                                    {% with expressions=result.get_detailed_results.expression_seconds %}
                                        {% for expr, duration in expressions.items %}
                                            <li>{{ expr|title }}: **{{ duration }}s**</li>
                                        {% empty %}
                                            <li>No detailed expression data recorded.</li>
                                        {% endfor %}
                                    {% endwith %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-info mt-5">
                You have not submitted any videos for analysis yet.
                <a href="{% url 'home' %}" class="alert-link">Go back to the home page</a> to upload your first video.
            </div>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>